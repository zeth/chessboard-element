<!doctype html>
<html>
  <head>
  <meta charset="utf-8">
  <title>chessboard-element &raquo; Only Allow Legal Moves</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="/chessboard-element/img/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600|Roboto+Mono">
  <link rel="stylesheet" href="/chessboard-element/css/prism-okaidia.css">
  <link rel="stylesheet" href="/chessboard-element/css/site.css">
</head>

  <!-- <title>chessboard-element Example #5000 - Only Allow Legal Moves</title> -->
  <body>
    <header>
  <div class="body-width-115f6 flex-c31d5">
    <div class="left-3edd4">
      <a class="homepage-link-98a24" href="/chessboard-element/">chessboard-element<span class="tld-bd9e6"></span></a>
    </div>
    <div class="right-05ad3">
      <a href="/chessboard-element/">Home</a>
      <a  href="/chessboard-element/examples/">Examples</a>
      <a  href="/chessboard-element/docs/">Docs</a>
      <a  href="/chessboard-element/download/">Download</a>
    </div>
  </div>
</header>

    <script type="module" src="/chessboard-element/js/chessboard-element.bundled.js"></script>
    <script src="/chessboard-element/js/chess-0.10.2.min.js"></script>

    <main>
      <div class="body-width-115f6 flex-c31d5 examples-c30bc">
        <nav class="example-nav-0e953" id="examplesNav">
          
          <h4>Basic Usage</h4>
          <ul>
            
            <li ><a href="/chessboard-element/examples/1000-empty-board/">Empty Board</a></li>
            
            <li ><a href="/chessboard-element/examples/1001-start-position/">Start Position</a></li>
            
            <li ><a href="/chessboard-element/examples/1002-fen/">FEN String</a></li>
            
            <li ><a href="/chessboard-element/examples/1003-position-object/">Position Object</a></li>
            
            <li ><a href="/chessboard-element/examples/1004-multiple-boards/">Multiple Boards</a></li>
            
          </ul>
          
          <h4>Config</h4>
          <ul>
            
            <li ><a href="/chessboard-element/examples/2000-config-position/">Start Position</a></li>
            
            <li ><a href="/chessboard-element/examples/2001-config-orientation/">Orientation</a></li>
            
            <li ><a href="/chessboard-element/examples/2002-config-notation/">Notation</a></li>
            
            <li ><a href="/chessboard-element/examples/2003-draggable-snapback/">Draggable Snapback</a></li>
            
            <li ><a href="/chessboard-element/examples/2004-piece-theme-string/">Piece Theme String</a></li>
            
            <li ><a href="/chessboard-element/examples/2005-animation-speed/">Animation Speed</a></li>
            
            <li ><a href="/chessboard-element/examples/2006-spare-pieces/">Spare Pieces</a></li>
            
            <li ><a href="/chessboard-element/examples/2030-piece-theme-function/">Piece Theme Function</a></li>
            
            <li ><a href="/chessboard-element/examples/2044-position-fen/">Position FEN</a></li>
            
            <li ><a href="/chessboard-element/examples/2063-position-object/">Position Object</a></li>
            
            <li ><a href="/chessboard-element/examples/2082-draggable-trash/">Draggable Trash</a></li>
            
          </ul>
          
          <h4>Methods</h4>
          <ul>
            
            <li ><a href="/chessboard-element/examples/3000-get-position/">Get Position</a></li>
            
            <li ><a href="/chessboard-element/examples/3001-set-position/">Set Position</a></li>
            
            <li ><a href="/chessboard-element/examples/3002-set-position-instant/">Set Position Instantly</a></li>
            
            <li ><a href="/chessboard-element/examples/3003-clear/">Clear Board</a></li>
            
            <li ><a href="/chessboard-element/examples/3004-move-pieces/">Move Pieces</a></li>
            
            <li ><a href="/chessboard-element/examples/3005-orientation/">Orientation</a></li>
            
            <li ><a href="/chessboard-element/examples/3007-resize/">Resize</a></li>
            
          </ul>
          
          <h4>Events</h4>
          <ul>
            
            <li ><a href="/chessboard-element/examples/4000-onchange/">change</a></li>
            
            <li ><a href="/chessboard-element/examples/4001-ondragstart/">drag-start</a></li>
            
            <li ><a href="/chessboard-element/examples/4002-ondragstart-prevent-drag/">drag-start Prevent Drag</a></li>
            
            <li ><a href="/chessboard-element/examples/4003-ondragmove/">drag-move</a></li>
            
            <li ><a href="/chessboard-element/examples/4004-ondrop/">drop</a></li>
            
            <li ><a href="/chessboard-element/examples/4005-ondrop-snapback/">drop Snapback</a></li>
            
            <li ><a href="/chessboard-element/examples/4006-ondrop-trash/">drop Trash</a></li>
            
            <li ><a href="/chessboard-element/examples/4011-onsnapbackend/">snapback-end</a></li>
            
            <li ><a href="/chessboard-element/examples/4012-onmoveend/">move-end</a></li>
            
          </ul>
          
          <h4>Integration</h4>
          <ul>
            
            <li class="active"><a href="/chessboard-element/examples/5000-legal-moves/">Only Allow Legal Moves</a></li>
            
            <li ><a href="/chessboard-element/examples/5001-play-random-computer/">Play Random Computer</a></li>
            
            <li ><a href="/chessboard-element/examples/5002-random-vs-random/">Random vs Random</a></li>
            
            <li ><a href="/chessboard-element/examples/5003-highlight-legal-moves/">Highlight Legal Moves</a></li>
            
            <li ><a href="/chessboard-element/examples/5004-piece-highlight1/">Piece Highlighting 1</a></li>
            
            <li ><a href="/chessboard-element/examples/5005-piece-highlight2/">Piece Highlighting 2</a></li>
            
          </ul>
          
        </nav>
        <div class="examples-body-9af4d" id="exampleBodyContainer">
          <h2>Only Allow Legal Moves</h2>          
          <p><p>You can integrate chessboard-element with the <a href="https://github.com/jhlywa/chess.js">chess.js</a> library to only allow legal moves.</p>
</p>
          <div class="container-4e1ee">
            <!-- Begin Example HTML -->
            <chess-board
    style="width: 400px"
    position="start"
    draggable-pieces>
</chess-board>

<label>Status:</label>
<div id="status"></div>
<label>FEN:</label>
<div id="fen"></div>
<label>PGN:</label>
<div id="pgn"></div>
            <!-- End Example HTML ---->
          </div>
          <h4>HTML</h4>
          <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chess-board</span><span class="token style-attr language-css"><span class="token attr-name"><br>    <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> 400px</span><span class="token punctuation">"</span></span><br>    <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>start<span class="token punctuation">"</span></span><br>    <span class="token attr-name">draggable-pieces</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chess-board</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>Status:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>status<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>FEN:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fen<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>PGN:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pgn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>

          
          <h4>JavaScript</h4>
          <pre class="language-js"><code class="language-js"><span class="token comment">// NOTE: this example uses the chess.js library:</span><br><span class="token comment">// https://github.com/jhlywa/chess.js</span><br><br><span class="token keyword">const</span> board <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'chess-board'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> game <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> statusElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#status'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> fenElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#fen'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> pgnElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#pgn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>board<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'drag-start'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>source<span class="token punctuation">,</span> piece<span class="token punctuation">,</span> position<span class="token punctuation">,</span> orientation<span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">;</span><br><br>  <span class="token comment">// do not pick up pieces if the game is over</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>game<span class="token punctuation">.</span><span class="token function">game_over</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// only pick up pieces for the side to move</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span><span class="token function">turn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'w'</span> <span class="token operator">&amp;&amp;</span> piece<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token regex">/^b/</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span><br>      <span class="token punctuation">(</span>game<span class="token punctuation">.</span><span class="token function">turn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'b'</span> <span class="token operator">&amp;&amp;</span> piece<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token regex">/^w/</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>board<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'drop'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>source<span class="token punctuation">,</span> target<span class="token punctuation">,</span> setAction<span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">;</span><br><br>  <span class="token comment">// see if the move is legal</span><br>  <span class="token keyword">const</span> move <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token keyword">from</span><span class="token operator">:</span> source<span class="token punctuation">,</span><br>    to<span class="token operator">:</span> target<span class="token punctuation">,</span><br>    promotion<span class="token operator">:</span> <span class="token string">'q'</span> <span class="token comment">// NOTE: always promote to a queen for example simplicity</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// illegal move</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>move <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">setAction</span><span class="token punctuation">(</span><span class="token string">'snapback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">updateStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// update the board position after the piece snap</span><br><span class="token comment">// for castling, en passant, pawn promotion</span><br>board<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'snap-end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  board<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span><span class="token function">fen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">updateStatus</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> status <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> moveColor <span class="token operator">=</span> <span class="token string">'White'</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>game<span class="token punctuation">.</span><span class="token function">turn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    moveColor <span class="token operator">=</span> <span class="token string">'Black'</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>game<span class="token punctuation">.</span><span class="token function">in_checkmate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// checkmate?</span><br>    status <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Game over, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moveColor<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is in checkmate.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>game<span class="token punctuation">.</span><span class="token function">in_draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// draw?</span><br>    status <span class="token operator">=</span> <span class="token string">'Game over, drawn position'</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    <span class="token comment">// game still on</span><br>    status <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moveColor<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to move</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br>    <span class="token comment">// check?</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>game<span class="token punctuation">.</span><span class="token function">in_check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      status <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moveColor<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is in check</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  statusElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> status<span class="token punctuation">;</span><br>  fenElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">fen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  pgnElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">pgn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token function">updateStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

          <script type="module">
            import {objToFen} from '/chessboard-element/js/chessboard-element.bundled.js';

            // Begin Example JS
            // NOTE: this example uses the chess.js library:
// https://github.com/jhlywa/chess.js

const board = document.querySelector('chess-board');
const game = new Chess();
const statusElement = document.querySelector('#status');
const fenElement = document.querySelector('#fen');
const pgnElement = document.querySelector('#pgn');

board.addEventListener('drag-start', (e) => {
  const {source, piece, position, orientation} = e.detail;

  // do not pick up pieces if the game is over
  if (game.game_over()) {
    e.preventDefault();
    return;
  }

  // only pick up pieces for the side to move
  if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
      (game.turn() === 'b' && piece.search(/^w/) !== -1)) {
    e.preventDefault();
    return;
  }
});

board.addEventListener('drop', (e) => {
  const {source, target, setAction} = e.detail;

  // see if the move is legal
  const move = game.move({
    from: source,
    to: target,
    promotion: 'q' // NOTE: always promote to a queen for example simplicity
  });

  // illegal move
  if (move === null) {
    setAction('snapback');
  }

  updateStatus();
});

// update the board position after the piece snap
// for castling, en passant, pawn promotion
board.addEventListener('snap-end', (e) => {
  board.setPosition(game.fen());
});

function updateStatus () {
  let status = '';

  let moveColor = 'White';
  if (game.turn() === 'b') {
    moveColor = 'Black';
  }

  if (game.in_checkmate()) {
    // checkmate?
    status = `Game over, ${moveColor} is in checkmate.`;
  } else if (game.in_draw()) {
    // draw?
    status = 'Game over, drawn position';
  } else {
    // game still on
    status = `${moveColor} to move`;

    // check?
    if (game.in_check()) {
      status += `, ${moveColor} is in check`;
    }
  }

  statusElement.innerHTML = status;
  fenElement.innerHTML = game.fen();
  pgnElement.innerHTML = game.pgn();
}

updateStatus();
            // End Example JS
          </script>

          
        </div>
      </div>
    </main>

    <footer>
  <div class="body-width-115f6 flex-c31d5">
    <div class="left-3edd4">
      <p>chessboard-element is released under the <a href="https://github.com/justinfagnani/chessboard-element/blob/master/LICENSE.md">MIT License</a></p>
      <p>the code can be found on <a href="https://github.com/justinfagnani/chessboard-element/">GitHub</a></p>
      <p>chessboard-element is a fork of the awesome <a href="https://github.com/oakmac/chessboardjs/">chessboard.js</a> project by Chris Oakman</p>
    </div>
  </div>
</footer>


  </body>
</html>
